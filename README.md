# ExploreWithMe

ExploreWithMe — это микросервисное REST-приложение для публикации и поиска мероприятий. Сервис помогает пользователям находить интересные события.

## Содержание

* [Технологии](#технологии)
* [Архитектура](#архитектура)
* [Описание API](#описание-api)

  * [Публичные эндпоинты](#публичные-эндпоинты)
  * [Эндпоинты авторизованных пользователей](#эндпоинты-авторизованных-пользователей)
  * [Административные эндпоинты](#административные-эндпоинты)
  * [Фильтрация и сортировка](#фильтрация-и-сортировка)

---

## Технологии

* Java 17
* Spring Boot (MVC, Data JPA + Specification)
* Maven + Checkstyle
* PostgreSQL
* Lombok
* MapStruct
* Hibernate Validator
* JUnit + Spring Boot Test

## Архитектура

Приложение разделено на два сервиса:

* **Основной сервис** — реализует бизнес-логику работы с мероприятиями, пользователями, комментариями и прочим;
* **Сервис статистики** — обрабатывает количество просмотров и обращений к публичным эндпоинтам.

## Описание API

### Публичные эндпоинты

| Метод | URL                      | Описание                              |
| ----- | ------------------------ | ------------------------------------- |
| GET   | `/events`                | Поиск и фильтрация событий            |
| GET   | `/events/{id}`           | Получение полной информации о событии |
| GET   | `/categories`            | Список категорий                      |
| GET   | `/categories/{catId}`    | Получение конкретной категории        |
| GET   | `/compilations`          | Получение подборок событий            |
| GET   | `/compilations/{compId}` | Получение конкретной подборки         |
| GET   | `/comments/{commentId}`  | Получение комментария по id           |

### Эндпоинты авторизованных пользователей

#### События

| Метод | URL                                         | Описание                        |
| ----- | ------------------------------------------- | ------------------------------- |
| GET   | `/users/{userId}/events`                    | Список событий пользователя     |
| POST  | `/users/{userId}/events`                    | Создание события                |
| GET   | `/users/{userId}/events/{eventId}`          | Получение события пользователя  |
| PATCH | `/users/{userId}/events/{eventId}`          | Редактирование события          |
| GET   | `/users/{userId}/events/{eventId}/requests` | Заявки на участие в событии     |
| PATCH | `/users/{userId}/events/{eventId}/requests` | Подтверждение/отклонение заявок |

#### Заявки

| Метод | URL                                           | Описание                           |
| ----- | --------------------------------------------- | ---------------------------------- |
| GET   | `/users/{userId}/requests`                    | Получение всех заявок пользователя |
| POST  | `/users/{userId}/requests?eventId=`           | Подать заявку на участие           |
| PATCH | `/users/{userId}/requests/{requestId}/cancel` | Отменить заявку                    |

#### Комментарии

| Метод  | URL                                                     | Описание                   |
| ------ | ------------------------------------------------------- | -------------------------- |
| POST   | `/users/{userId}/events/{eventId}/comments`             | Создание комментария       |
| PATCH  | `/users/{userId}/events/{eventId}/comments/{commentId}` | Редактирование комментария |
| DELETE | `/users/{userId}/events/{eventId}/comments/{commentId}` | Удаление комментария       |
| GET    | `/users/{userId}/comments`                              | Список своих комментариев  |

### Административные эндпоинты

#### События

| Метод | URL                  | Описание                          |
| ----- | -------------------- | --------------------------------- |
| GET   | `/admin/events`      | Поиск событий по фильтрам         |
| PATCH | `/admin/events/{id}` | Публикация или отклонение события |

#### Категории

| Метод  | URL                         | Описание             |
| ------ | --------------------------- | -------------------- |
| POST   | `/admin/categories`         | Создание категории   |
| PATCH  | `/admin/categories`         | Обновление категории |
| DELETE | `/admin/categories/{catId}` | Удаление категории   |

#### Подборки

| Метод  | URL                        | Описание                |
| ------ | -------------------------- | ----------------------- |
| POST   | `/admin/compilations`      | Создание подборки       |
| PATCH  | `/admin/compilations/{id}` | Редактирование подборки |
| DELETE | `/admin/compilations/{id}` | Удаление подборки       |

#### Пользователи

| Метод  | URL                 | Описание              |
| ------ | ------------------- | --------------------- |
| POST   | `/admin/users`      | Создание пользователя |
| DELETE | `/admin/users/{id}` | Удаление пользователя |
| GET    | `/admin/users`      | Поиск пользователей   |

#### Комментарии

| Метод  | URL                    | Описание             |
| ------ | ---------------------- | -------------------- |
| GET    | `/admin/comments`      | Поиск комментариев   |
| DELETE | `/admin/comments/{id}` | Удаление комментария |


## Фильтрация и сортировка

### Параметры публичного поиска событий

* `text`: ключевые слова для поиска
* `categories`: список id категорий
* `paid`: только платные / бесплатные события
* `rangeStart`, `rangeEnd`: диапазон дат в формате `yyyy-MM-dd HH:mm:ss`
* `onlyAvailable`: только события с доступными местами
* `sortOpt`: сортировка (`EVENT_DATE`, `VIEWS`)

### Административный поиск событий

* `users`: id инициаторов
* `states`: список состояний (например, `PENDING`, `PUBLISHED`, `CANCELED`)
* `categories`: id категорий
* `rangeStart`, `rangeEnd`

### Поиск комментариев (админ)

* `userIds`: id авторов
* `eventIds`: id событий
* `rangeStart`, `rangeEnd`: диапазон дат
* `sort`: `CREATED_ASC` или `CREATED_DESC`

